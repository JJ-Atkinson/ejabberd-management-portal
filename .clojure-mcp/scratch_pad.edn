{"graalvm-plan" {"challenges" [{"library" "SMACK XMPP Client", "severity" "HIGH", "issues" ["Heavy reflection usage for stanza parsing" "ServiceLoader dynamic loading" "Persistent XMPP connections" "Thread pools and executors"], "strategy" "Use tracing agent + manual reflection configs"} {"library" "Ring/Jetty", "severity" "MEDIUM", "issues" ["Servlet reflection" "Thread pool management" "SSL/TLS configuration"], "strategy" "Standard Ring/Jetty reflection configs available"} {"library" "clj-http", "severity" "MEDIUM", "issues" ["Apache HttpClient reflection" "SSL context"], "strategy" "Use bb-http instead or add HttpClient configs"} {"library" "Buddy (JWT/Crypto)", "severity" "LOW", "issues" ["JCA provider registration" "Random number generation"], "strategy" "Standard crypto reflection configs"} {"library" "Telemere/SLF4J", "severity" "LOW", "issues" ["Logger initialization"], "strategy" "Standard logging reflection configs"}], "steps" [], "config-files" [], "implementation-steps" [{"phase" "1. Setup Dependencies", "tasks" ["Add com.github.clj-easy/graal-build-time to deps.edn" "Add direct-linking JVM opts to compilation" "Ensure Clojure 1.12+ (already have 1.12.3)"], "notes" "graal-build-time handles Clojure class initialization automatically"} {"phase" "2. Update Entry Point", "tasks" ["Add (:gen-class) to dev.freeformsoftware.run.prod namespace" "Verify -main function signature" "Compile all namespaces AOT"], "notes" "Need gen-class for native-image to find main method"} {"phase" "3. Reduce Reflection Surface", "tasks" ["Keep *warn-on-reflection* true everywhere (already done)" "Replace clj-http with org.babashka/http-client (already in deps)" "Audit code for any remaining reflection warnings"], "notes" "bb-http-client is GraalVM-friendly, clj-http needs heavy configs"} {"phase" "4. Create GraalVM Configs", "tasks" ["Create graal-configs/ directory" "Add reflect-config.json for Ring/Jetty" "Add reflect-config.json for Buddy crypto" "Add reflect-config.json for SMACK XMPP" "Add resource-config.json for SMACK ServiceLoader" "Add jni-config.json if needed"], "notes" "SMACK will need the most extensive configs - use tracing agent"} {"phase" "5. Build Script", "tasks" ["Create bin/compile-native script" "AOT compile all namespaces to classes/" "Run native-image with all configs" "Set appropriate memory limits (-J-Xmx4g or higher)" "Enable direct linking for faster compilation"], "notes" "Expect 5-10 minute compile times initially"} {"phase" "6. Iterative Testing", "tasks" ["Test basic server startup" "Test without XMPP bot first (comment out)" "Add XMPP bot and run tracing agent" "Merge generated configs with hand-written ones" "Test all features work in native image"], "notes" "SMACK is high risk - may need multiple iterations"}], "recommended-approach" {"strategy" "Phased Implementation", "reasoning" "The SMACK XMPP library is complex and high-risk for GraalVM. A phased approach reduces risk.", "phases" [{"name" "Phase 1: Basic Server (No XMPP)", "goal" "Get web server running as native image without XMPP bot", "success-criteria" ["Server starts" "JWT auth works" "User/Room management pages load" "File DB operations work"], "estimated-effort" "2-4 hours", "risk" "LOW"} {"name" "Phase 2: Add XMPP Support", "goal" "Enable XMPP bot with full functionality", "success-criteria" ["XMPP connection establishes" "Bot can send/receive messages" "Room affiliations work" "Roster sync works"], "estimated-effort" "4-8 hours", "risk" "HIGH - SMACK may be incompatible"}], "alternative" "If SMACK proves incompatible, consider: 1) Run XMPP bot as separate JVM process, 2) Use different XMPP library, 3) Keep web portal as native image, XMPP bot as JAR"}}}